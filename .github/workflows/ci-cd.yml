name : sentiment analysis workflow

on: 
 push: 
  branches: [main,dev]
 workflow_dispatch:
permissions:
  contents: write

jobs:
 build_and_deploy:
  runs-on: ubuntu-latest
  env:
   THRESHOLD_SCORE: ${{secrets.THRESHOLD_SCORE}}
   HF_TOKEN: ${{secrets.HF_TOKEN}}
   EMAIL_USER: ${{secrets.EMAIL_USER}}
   EMAIL_PASS: ${{secrets.EMAIL_PASS}}
   EMAIL_RECEIVER: ${{secrets.EMAIL_RECEIVER}}
  steps:
    - name: checkout repo
      uses: actions/checkout@v3

    - name : set-up python
      uses : actions/setup-python@v4
      with: 
        python-version: '3.10'


    - name: initialising dependencies
      run: |
       python -m pip install -r requirements.txt
       python -m pip install -U "transformers[torch]" accelerate

    - name: Check threshod installation
      run: python -c "import os; THRESHOLD = float(os.getenv('THRESHOLD_SCORE')); print('âœ… threshold:', THRESHOLD)"

    - name: model training 
      run: python scripts/train.py
    - name: Commit and push training logs
      run: |
        git config user.name "dani-ange"
        git config user.email "danielledjofang2003@gmail.com"
        git add docs/
        git commit -m "ðŸ“Š Auto-update training logs"
        git push

    - name: model evaluation
      run: python scripts/evaluate.py

    - name: model check and deployment
      run : python scripts/deploy.py
    - name: generate doc
      run: |
        mkdir -p doc
        python -m pydoc -w scripts/train.py
        python -m pydoc -w scripts/evaluate.py
        python -m pydoc -w scripts/deploy.py
        mv train.html  evaluate.html  deploy.html doc/
    - name: zip and bundle the  doc
      run : zip -r bundle.zip  doc/

    - name: mail sending 
      run : python scripts/send_email.py

